apiVersion: v1
kind: Pod
metadata:
  name: networking-debug-pod
  namespace: default
spec:
  hostNetwork: true       # Equivalent to --network=host
  restartPolicy: Never
  nodeName: "pokprod-b93r39s1"  # <--- Forces pod to this specific node
  containers:
  - name: networking-debug-container
    image: quay.io/rajjoshi/networking-debug-container
    securityContext:
      privileged: true    # Provides access to all host devices including /dev/infiniband/*
    
    # Access to InfiniBand devices (privileged mode already provides this, but explicit is better)
    volumeMounts:
    - name: dev-infiniband
      mountPath: /dev/infiniband
    
    command: ["/bin/bash", "-c"]
    args: 
    - |
      echo "=== Networking Debug Container Ready ==="
      echo "Available tools: ib_write_bw, ibv_devinfo, perftest suite, MLNX OFED tools"
      echo "CUDA support: Enabled (use --use_cuda=<id> with perftest)"
      echo ""
      sleep infinity
  
  volumes:
  - name: dev-infiniband
    hostPath:
      path: /dev/infiniband
      type: Directory